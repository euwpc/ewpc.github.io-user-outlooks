<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Submit Outlook — User Outlooks</title>

<style>
  body{background:#0d1117;color:#e6edf3;font-family:Arial;margin:0}
  nav{background:#161b22;padding:12px 18px;display:flex;justify-content:space-between;border-bottom:1px solid #30363d}
  nav a{color:#e6edf3;text-decoration:none;margin-left:12px}
  .wrap{max-width:850px;margin:24px auto;padding:0 16px}
  .card{background:#161b22;padding:20px;border-radius:8px;border:1px solid #30363d}
  input,select,textarea{width:100%;padding:10px;border-radius:6px;border:1px solid #30363d;background:#0d1117;color:#e6edf3;margin-top:6px}
  button{background:#238636;color:#fff;padding:10px 14px;border-radius:6px;border:none;cursor:pointer;margin-top:16px}
  button:hover{background:#2ea043}
</style>
</head>

<body>
<nav>
  <div class="logo">User Outlooks</div>
  <div>
    <a href="index.html">Submit</a>
    <a href="archive.html">Approved Outlooks</a>
    <a href="pending.html">Pending</a>
  </div>
</nav>

<div class="wrap">
  <h1>Submit Your Outlook</h1>
  <div class="card">
    <form id="submitForm">
      <label>Username:</label>
      <input id="username" required>

      <label>Region:</label>
      <select id="region" required>
        <option value="">-- Select region --</option>
        <option>Baltic Region</option>
        <option>Northern Europe</option>
        <option>Central Europe</option>
        <option>Western Europe</option>
        <option>Southern Europe</option>
        <option>Eastern Europe</option>
        <option>Scandinavia</option>
        <option>British Isles</option>
      </select>

      <label>Title:</label>
      <input id="title" required>

      <label>Discussion / Analysis:</label>
      <textarea id="discussion" rows="6" required></textarea>

      <label>Upload Outlook Image:</label>
      <input type="file" id="imageFile" accept="image/*" required>

      <button type="submit">Submit</button>
    </form>
  </div>
</div>

<script>
const CLOUD_NAME = "dhezavkez";
const UPLOAD_PRESET = "unsigned";

document.getElementById("submitForm").addEventListener("submit", async(e)=>{
  e.preventDefault();

  const username = username.value.trim();
  const region = region.value;
  const title = title.value.trim();
  const discussion = discussion.value.trim();
  const imageFile = imageFile.files[0];

  // Upload image → Cloudinary
  const data = new FormData();
  data.append("file", imageFile);
  data.append("upload_preset", UPLOAD_PRESET);
  const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, { method:"POST", body:data });
  const cloud = await res.json();

  // Send JSON data to GitHub Action trigger
  await fetch("https://ewpc.estoniaweather.workers.dev/", {
  method: "POST",
  headers: {"Content-Type": "application/json"},
  body: JSON.stringify({
    username, region, title, discussion, imageUrl: cloud.secure_url
  })
});


  alert("✅ Submitted! Your outlook is waiting for admin approval.");
  submitForm.reset();
});
</script>

</body>
</html>
