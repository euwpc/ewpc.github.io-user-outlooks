<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pending Outlooks — Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body{background:#0d1117;color:#e6edf3;font-family:Arial;margin:0;}
  nav{background:#161b22;padding:14px;border-bottom:1px solid #30363d;}
  nav a{color:#e6edf3;margin-right:14px;text-decoration:none;}
  .container{max-width:1000px;margin:auto;padding:30px;}
  table{width:100%;border-collapse:collapse;margin-top:20px;}
  th,td{border-bottom:1px solid #30363d;padding:12px;text-align:left;}
  img{height:70px;border-radius:6px;}
  button{padding:6px 10px;border:none;border-radius:6px;cursor:pointer;}
  .approve{background:#238636;color:white;}
  .reject{background:#b62324;color:white;margin-left:6px;}
  #loginBox{max-width:420px;margin:80px auto;background:#161b22;padding:25px;border:1px solid #30363d;border-radius:8px;}
  input{width:100%;padding:10px;margin-top:12px;border-radius:6px;border:1px solid #30363d;background:#0d1117;color:#e6edf3;}
</style>
</head>
<body>

<nav>
  <a href="index.html">Submit</a>
  <a href="archive.html">Approved Outlooks</a>
  <a href="pending.html">Pending (Admin)</a>
</nav>

<div id="loginBox">
  <h2>Admin Login</h2>
  <input id="adminPass" type="password" placeholder="Enter admin password">
  <button onclick="login()" style="margin-top:14px;background:#238636;color:white;">Login</button>
</div>

<div class="container" id="panel" style="display:none;">
  <h1>Pending Outlooks</h1>
  <table id="pendingTable">
    <tr>
      <th>User</th>
      <th>Title</th>
      <th>Region</th>
      <th>Preview</th>
      <th>Actions</th>
    </tr>
  </table>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
  import { getFirestore, collection, getDocs, deleteDoc, addDoc, doc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCA0EqMhYgT0zJMbJemdcvCmZBdEQYmj_s",
    authDomain: "ewpc-f9bd6.firebaseapp.com",
    projectId: "ewpc-f9bd6",
    storageBucket: "ewpc-f9bd6.firebasestorage.app",
    messagingSenderId: "782175980177",
    appId: "1:782175980177:web:f7272e9bb393fded11cd30",
    measurementId: "G-Z6DC5X7ELM"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const ADMIN_PASSWORD = "S6!ÖhqR.T";

  function login(){
    const input = document.getElementById("adminPass").value;
    if(input === ADMIN_PASSWORD){
      document.getElementById("loginBox").style.display = "none";
      document.getElementById("panel").style.display = "block";
      loadPending();
    } else{
      alert("Incorrect password.");
    }
  }

  async function loadPending(){
    const table = document.getElementById("pendingTable");
    const snapshot = await getDocs(collection(db, "pendingOutlooks"));

    snapshot.forEach(docItem => {
      const data = docItem.data();
      const row = document.createElement("tr");

      row.innerHTML = `
        <td>${data.username}</td>
        <td>${data.title}</td>
        <td>${data.region}</td>
        <td><img src="${data.imageUrl}" /></td>
        <td>
          <button class="approve" onclick="approve('${docItem.id}', '${data.username}', '${data.region}', '${data.title}', \`${data.discussion}\`, '${data.imageUrl}')">Approve</button>
          <button class="reject" onclick="rejectOutlook('${docItem.id}')">Reject</button>
        </td>
      `;

      table.appendChild(row);
    });
  }

  window.approve = async function(id, username, region, title, discussion, imageUrl){
    await addDoc(collection(db, "approvedOutlooks"), {
      username, region, title, discussion, imageUrl, timestamp: Date.now()
    });
    await deleteDoc(doc(db, "pendingOutlooks", id));
    alert("Approved!");
    location.reload();
  }

  window.rejectOutlook = async function(id){
    await deleteDoc(doc(db, "pendingOutlooks", id));
    alert("Rejected.");
    location.reload();
  }
</script>

</body>
</html>
