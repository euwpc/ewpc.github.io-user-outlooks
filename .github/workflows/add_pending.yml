name: Add Pending Outlook

on:
  repository_dispatch:
    types: [add_outlook]

jobs:
  add_pending:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Read Inputs
        run: |
          echo "USERNAME=${{ github.event.client_payload.username }}" >> $GITHUB_ENV
          echo "REGION=${{ github.event.client_payload.region }}" >> $GITHUB_ENV
          echo "TITLE=${{ github.event.client_payload.title }}" >> $GITHUB_ENV
          echo "DISCUSSION=${{ github.event.client_payload.discussion }}" >> $GITHUB_ENV
          echo "IMAGE=${{ github.event.client_payload.imageUrl }}" >> $GITHUB_ENV

      - name: Add to pending.json
        run: |
          jq --arg user "$USERNAME" --arg reg "$REGION" --arg title "$TITLE" --arg disc "$DISCUSSION" --arg img "$IMAGE" \
          '. + [{"username":$user,"region":$reg,"title":$title,"discussion":$disc,"image":$img}]' \
          outlooks/data/pending.json > pending_tmp.json
          mv pending_tmp.json outlooks/data/pending.json

      - name: Commit & Push
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git add outlooks/data/pending.json
          git commit -m "Add new pending outlook"
          git push
